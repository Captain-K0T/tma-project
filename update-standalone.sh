#!/bin/bash

# –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è standalone –≤–µ—Ç–æ–∫ TMA –ø—Ä–æ–µ–∫—Ç–∞
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./update-standalone.sh [tma-number] –∏–ª–∏ ./update-standalone.sh all

set -e  # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ standalone –≤–µ—Ç–æ–∫..."

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–¥–Ω–æ–π standalone –≤–µ—Ç–∫–∏
update_standalone_branch() {
    local tma_num=$1
    local branch_name="tma-${tma_num}-standalone"
    
    echo "üìù –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ç–∫–∏ ${branch_name}..."
    
    # –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –Ω—É–∂–Ω—É—é –≤–µ—Ç–∫—É
    git checkout ${branch_name}
    
    # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤–µ—Ç–∫—É –∫ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é main (–ë–ï–ó–û–ü–ê–°–ù–û!)
    git reset --hard main
    
    # –£–¥–∞–ª—è–µ–º –Ω–µ–Ω—É–∂–Ω—ã–µ TMA –ø–∞–ø–∫–∏, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—É—é
    for i in 1 2 3 4 5; do
        if [ $i -ne $tma_num ]; then
            if [ -d "tma-${i}" ]; then
                git rm -rf "tma-${i}"
                echo "  ‚ùå –£–¥–∞–ª–µ–Ω–∞ –ø–∞–ø–∫–∞ tma-${i}"
            fi
        fi
    done
    
    # –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ñ–∞–π–ª—ã –Ω—É–∂–Ω–æ–≥–æ TMA –≤ –∫–æ—Ä–µ–Ω—å
    if [ -d "tma-${tma_num}" ]; then
        # –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã TMA –≤ –∫–æ—Ä–µ–Ω—å
        cp -r tma-${tma_num}/* .
        
        # –£–¥–∞–ª—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É TMA
        git rm -rf "tma-${tma_num}"
        
        # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –≤ –∫–æ—Ä–Ω–µ
        git add .
        
        echo "  ‚úÖ –§–∞–π–ª—ã TMA-${tma_num} –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ –∫–æ—Ä–µ–Ω—å"
    fi
    
    # –ö–æ–º–º–∏—Ç–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
    git commit -m "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ standalone –≤–µ—Ç–∫–∏ TMA-${tma_num} —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ –∏–∑ main

ü§ñ Generated with automated script

Co-Authored-By: Claude <noreply@anthropic.com>"
    
    # –ü—É—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
    git push origin ${branch_name} --force-with-lease
    
    echo "  üéâ –í–µ—Ç–∫–∞ ${branch_name} —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!"
}

# –°–Ω–∞—á–∞–ª–∞ —É–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ –º—ã –Ω–∞ main –∏ –ø—É—à–∏–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
echo "üìã –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–µ—Ç–∫—É main..."
git checkout main

echo "üì§ –ü—É—à –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ main..."
git push origin main

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–∏–µ –≤–µ—Ç–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å
if [ "$1" = "all" ] || [ -z "$1" ]; then
    echo "üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö standalone –≤–µ—Ç–æ–∫..."
    for tma_num in 1 2 3 4 5; do
        update_standalone_branch $tma_num
    done
elif [[ "$1" =~ ^[1-5]$ ]]; then
    echo "üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ç–∫–∏ TMA-$1..."
    update_standalone_branch $1
else
    echo "‚ùå –û—à–∏–±–∫–∞: –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: ./update-standalone.sh [1-5] –∏–ª–∏ ./update-standalone.sh all"
    exit 1
fi

# –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ main
echo "üè† –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≤–µ—Ç–∫—É main..."
git checkout main

echo "‚ú® –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!"
echo "üéØ Standalone –≤–µ—Ç–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å main"